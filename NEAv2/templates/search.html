

<!--search page-->

<!--all code extends form the base.html code-->

{% extends 'base.html' %}

{% block content %}
  <head>
    <title>Quickfit</title>
<!--      jquery script-->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

<!--custom hello message displayed to a user-->
<h2>Hello {{current_user.forename}}</h2>

  <br>



   <!-- Search Form -->
    <form method="post">
        {{ form.hidden_tag() }}
        <div class="form-row">
            <!-- Clothing company dropdown -->
            <div class="form-group col-md-6">
                {{ form.clothing_company.label(class="form-control-label") }}
                {{ form.clothing_company(id="clothing_company", class="form-control") }}
            </div>
            <br>

            <!-- Keyword search box -->
            <div class="form-group col-md-5">
                {{ form.keyword.label(class="form-control-label") }}
                {{ form.keyword(class="form-control", placeholder="Type keyword...") }}
            </div>
            <br>
            <div class="form-group col-md-5">
                {{ form.url.label(class="form-control-label") }}
                {{ form.url(id="url", class="form-control", placeholder="Paste URL") }}
            </div>
            <br>

            <!-- Submit button -->
            <div class="form-group col-md-1">
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </div>
    </form>
<br>
<br>

  
  {% for product in products %}
  <!--a div is created for every product found with data passed through from the flask route-->
<div class="product">
    <img src="{{ product.image }}" alt="{{ product.title }}" style="width:350px; height:400px;">
    <h3>{{ product.title }}</h3>
    <p>{{product.subtitle}}</p>
    <p>Price: Â£{{ product.price }}</p>

    <!--add to watchlist route called when a threshold price is inputted and the 'add to watchlist button is pressed'-->
    <form action="{{ url_for('addtowatchlist') }}" method="post">
        <input type="hidden" name="title" value="{{ product.title }}">
        <input type="hidden" name="subtitle" value="{{ product.subtitle }}">
        <input type="hidden" name="image" value="{{ product.image }}">
        <input type="hidden" name="price" value="{{ product.price }}">
        <input type="hidden" name="product_id" value="{{ product.product_id|default(0) }}">
        <input type="hidden" name="brand" id="brand" value="">
        <input type="hidden" name="product_url" id="product_url" value="">
        <label for="target_price">Target Price:</label>
        <input type="number" id="target_price" name="target_price" value="0" step="0.01">
        <button type="submit">Add to Watchlist</button>
    </form>
</div>
  <br>
  <br>
{% endfor %}

<script>
$(document).ready(function() {
// Copies the initial value from the dropdown to the hidden field
  $('#brand').val($('#clothing_company').val());

// Updates the hidden field whenever the dropdown value changes
  $('#clothing_company').change(function() {
    $('#brand').val($(this).val());
  });

   // Copies the initial value from the URL input to the hidden field
  $('#product_url').val($('#url').val() || 'None');

  // Updates the hidden field whenever the URL input value changes
  $('#url').on('input', function() {
    $('#product_url').val($(this).val() || 'None');
  });
});
</script>

  </body>

{% endblock %}